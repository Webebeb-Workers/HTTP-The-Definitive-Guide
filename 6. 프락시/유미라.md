# 웹 중개자
<img width="578" alt="image" src="https://github.com/user-attachments/assets/46a6eecd-2126-4e52-bded-dcfc9fb494c1" />

- 웹 프락시 서버는 클라이언트와 서버 간의 중개 역할을 하며, 클라이언트는 프락시 서버를 통해 서버와 통신한다. 
- 프락시 서버는 HTTP 서버이자 클라이언트의 기능을 모두 수행하며, 요청을 처리하고 응답을 반환해야 한다.

## 개인 프락시와 공유 프락시
- **개인 프락시** : 한 명의 클라이언트만 사용, 주로 사용자 컴퓨터에서 실행한다.
- **공용 프락시** : 여러 클라이언트가 공유, 관리가 용이하고 캐시 프락시 같은 경우 사용자 수가 많을수록 효율적이다.

## 프락시 대 게이트웨이
- **프락시** : 같은 프로토콜을 사용하는 클라이언트와 서버를 연결한다. 예: HTTP 프락시
- **게이트웨이** : 서로 다른 프로토콜을 사용하는 클라이언트와 서버를 연결하고, 프로토콜 변환을 수행한다. 예: HTTP/POP 게이트웨이
- 실제로는 두 개념이 겹치는 경우가 많고, 일부 프락시는 프로토콜 변환 기능을 포함하기도 한다.

# 왜 프락시를 사용하는가?
- 프락시 서버는 보안을 개선하고 성능을 높이며 비용을 절감하는 등 다양한 실용적인 역할을 한다. 
- 모든 HTTP 트래픽을 모니터링하고 수정할 수 있어, 이를 통해 부가적인 가치를 제공하는 여러 유용한 웹 서비스를 구현할 수 있다.

## 어린이 필터
<img width="582" alt="image" src="https://github.com/user-attachments/assets/3f76efec-b5be-4d84-98fa-00173259ec5e" />

- 필터링 프락시는 초등학교처럼 어린이에게 교육 콘텐츠를 제공하면서 부적절한 성인 콘텐츠를 차단하는 데 사용된다. 
- 프락시는 교육 콘텐츠에는 제한 없이 접근을 허용하고, 부적절한 사이트에 대한 접근은 강제로 차단할 수 있다.

## 문서 접근 제어자
<img width="574" alt="image" src="https://github.com/user-attachments/assets/bbbfd918-fbc5-4c6c-a058-b442af3846cc" />

- 프락시 서버는 여러 웹 서버와 리소스에 대한 단일 접근 제어 전략을 구현하고 감사 추적을 가능하게 한다.
- 이는 대기업 환경이나 분산된 조직에서 유용하며, 다양한 웹 서버에 대한 접근 제어를 중앙 프락시 서버에서 관리하고 갱신할 수 있다. 

## 보안 방화벽
<img width="574" alt="image" src="https://github.com/user-attachments/assets/d7b49c9a-a968-4aea-81dd-687a7849c0f4" />

- 프락시 서버는 네트워크 보안 강화에 사용되며, 응용 레벨 프로토콜 흐름을 통제한다. 
- 트래픽을 세밀하게 분석하고, 바이러스를 제거하는 기능을 제공하는 후크(hook)를 통해 보안을 강화한다.

## 웹 캐시
<img width="576" alt="image" src="https://github.com/user-attachments/assets/9834cc75-352d-4a63-85e7-94e7b6a594a8" />

-  프락시 캐시는 인기 있는 문서를 로컬에 저장해 빠르게 제공함으로써 인터넷 통신 속도를 개선하고 비용을 절감한다.

## 대리 프락시
<img width="570" alt="image" src="https://github.com/user-attachments/assets/fc49d534-4a9d-4694-a2a3-357747959b61" />

- 웹 서버처럼 요청을 받아 실제 콘텐츠가 있는 서버와 통신해 사용자에게 전달한다.
- 예 : 느린 웹 서버의 성능 개선(서버 가속기로 활용), 콘텐츠 라우팅과 결합해 복제 콘텐츠의 분산 네트워크 구축

## 콘텐츠 라우터
<img width="571" alt="image" src="https://github.com/user-attachments/assets/ce348d5c-1644-4c80-8a63-aeb20ec2d99e" />

- 프락시 서버는 요청을 특정 웹 서버로 유도하는 콘텐츠 라우터로 동작할 수 있다. 
- 이를 통해 성능 향상을 원하는 사용자에게는 가까운 복제 캐시로, 필터링 서비스에 가입한 사용자에게는 필터링 프락시를 거치도록 요청을 전달하는 등 맞춤형 서비스를 제공할 수 있다.

## 트랜스코더
<img width="583" alt="image" src="https://github.com/user-attachments/assets/5e70a072-4f31-421d-b0ea-2a2f683157a8" />

- 트랜스코딩 프락시는 콘텐츠를 전달하기 전에 포맷을 수정한다.
- 이미지 변환, 텍스트 압축, 웹페이지 축소, 외국어 번역 등으로 다양한 기기와 상황에 맞는 콘텐츠를 제공한다.

## 익명화 프락시
<img width="576" alt="image" src="https://github.com/user-attachments/assets/9531b266-f1cc-4c18-9a52-7f733d23d625" />

- 익명화 프락시는 HTTP 메시지에서 개인 정보를 식별할 수 있는 요소(IP 주소, 헤더, 쿠키 등)를 제거해 개인 정보 보호와 익명성을 보장한다.
- 예를 들어, User-Agent 헤더에서 컴퓨터 정보 제거, From 헤더에서 이메일 주소 삭제, Referer 헤더와 Cookie 헤더를 제거해 신원 정보를 숨긴다.

# 프락시는 어디에 있는가?
## 프락시 서버 배치
<img width="573" alt="image" src="https://github.com/user-attachments/assets/5b14bf51-91f4-4d21-b548-e65ed3293ef1" />

### 출구 프락시
- 출구 프락시는 로컬 네트워크와 외부 인터넷 사이의 트래픽을 제어하는 역할을 한다. 
- 이를 통해 해커로부터 보호하거나, 인터넷 요금을 절감하고 성능을 개선할 수 있다. 
- 예를 들어, 초등학교에서는 부적절한 콘텐츠의 접근을 차단하기 위해 필터링 출구 프락시를 사용할 수 있다.

### 접근 프락시
- 접근(입구) 프락시는 ISP의 접속 지점에 배치되어 고객 요청을 처리하다.
- 자주 요청되는 문서를 캐시하여 다운로드 속도를 개선하고 대역폭 비용을 절감한다.

### 대리 프락시
- 대리 프락시(리버스 프락시)는 네트워크의 끝에 위치하여 웹 서버로 향하는 요청을 처리하고, 필요할 때만 웹 서버와 통신한다. 
- 이 프락시는 웹 서버의 앞에 위치해 보안을 강화하고, 캐시 기능을 통해 성능을 개선할 수 있다. 
- 대리 프락시는 웹 서버의 이름과 IP 주소로 스스로를 가장해 모든 요청을 자신에게 유도한다.

### 네트워크 교환 프락시
- 네트워크 교환 프락시는 인터넷 피어링 교환 지점에 배치되어 트래픽 흐름을 감시하고 캐시를 활용하여 혼잡을 완화하는 역할을 한다.

## 프락시 계층
<img width="570" alt="image" src="https://github.com/user-attachments/assets/abce1ffe-ec57-4f0d-b109-7275376ee868" />

- 프락시 계층은 여러 프락시 서버들이 서로 연결된 구조로, 메시지가 최종 원 서버에 도달할 때까지 여러 프락시를 거친다. 
- 이 계층에서는 프락시 서버들이 부모-자식 관계를 가지며, 인바운드 프락시(서버에 가까운)와 아웃바운드 프락시(클라이언트에 가까운)로 구분된다. 
- 예를 들어, 프락시 2는 프락시 3의 자식이고, 프락시 3은 프락시 2의 부모이다.

### 프락시 계층 콘텐츠 라우팅
<img width="570" alt="image" src="https://github.com/user-attachments/assets/7cd19110-0a9b-4964-87fd-0105a9f3a66d" />

- 프락시 계층은 일반적으로 고정적이지 않으며, 프락시 서버는 다양한 조건에 따라 메시지를 다른 프락시 서버나 원 서버로 동적으로 라우팅할 수 있다.
- 예를 들어, 요청된 객체에 따라 가까운 캐시 서버나 압축 프락시로 메시지를 보낸다.
- 프락시 서버는 상황에 맞게 부모 프락시나 원 서버로 요청을 라우팅할 수 있다.

### 동적 부모 선택 예시
- **부하 균형** : 자식 프락시는 부모 프락시의 작업량을 기준으로 선택하여 부하를 분산한다.
- **지리적 인접성** : 자식 프락시는 원 서버의 위치를 고려해 해당 지역을 담당하는 부모를 선택한다.
- **프로토콜/타입 라우팅** : 자식 프락시는 요청의 프로토콜이나 URI 유형에 따라 다른 부모나 원 서버로 라우팅할 수 있다.
- **특별 서비스 라우팅** : 유료 서비스 가입자는 성능 개선을 위해 캐시나 압축 엔진으로 라우팅될 수 있다.

> 동적 부모 라우팅 로직은 제품마다 다르게 구현된다.

## 어떻게 프락시가 트래픽을 처리하는가
<img width="577" alt="image" src="https://github.com/user-attachments/assets/b4f218e1-7919-4772-b3d8-fda3bf0368a0" />

### 클라이언트를 수정한다
- 구글 크롬과 마이크로소프트의 웹 브라우저를 포함한 많은 웹 클라이언트들은 수동 또는 자동으로 프락시 설정을 지원한다. 
- 클라이언트가 프락시를 사용하도록 설정되면, 클라이언트는 HTTP 요청을 원 서버로 직접 보내지 않고 의도적으로 프락시 서버를 통해 요청을 전달한다.

### 네트워크를 수정한다
- 인터셉트 프락시는 클라이언트가 알지 못한 채 웹 트래픽을 가로채어 프락시로 전달하는 기술이다.
- 이 방식은 HTTP 트래픽을 감시하고 가로채는 스위칭 장치나 라우팅 장치를 필요로 하며, 클라이언트는 이를 인식하거나 제어할 수 없다.
- 이를 통해 트래픽은 의도적으로 프락시로 리디렉션된다.

### DNS 이름공간을 수정한다
- 대리 프락시(리버스 프락시)는 웹 서버 앞에 위치하며, 클라이언트의 요청을 직접 처리하는 대신 웹 서버에 전달한다.
- 이 프락시는 웹 서버의 이름과 IP 주소를 대신 사용하여, 모든 요청이 대리 프락시로 향하게 된다. 
- 이 과정은 수동으로 DNS 이름 테이블을 편집하거나, 동적 DNS 서버를 통해 자동으로 처리될 수 있다.
- 일부 시스템에서는 실제 서버의 주소와 이름이 변경되고, 대리 프락시에게는 기존 주소와 이름이 할당된다.

### 웹 서버를 수정한다
- 웹 서버는 HTTP 리다이렉션 명령(응답 코드 305)을 클라이언트에게 보내어 요청을 프락시로 리다이렉트할 수 있다.
- 클라이언트는 이 리다이렉션을 받은 후, 프락시 서버와의 트랜잭션을 시작하게 된다.

# 클라이언트 프락시 설정
## 클라이언트 프락시 설정 : 수동
- 웹 클라이언트는 프락시를 수동으로 설정할 수 있다. 
- 구글 크롬과 마이크로소프트 인터넷 익스플로러는 각각 설정 메뉴에서 간편하게 프락시를 설정할 수 있는 기능을 제공한다. 
- 사용자는 프락시의 호스트와 포트를 지정하며, 일부 ISP는 맞춤형 운영 체제를 제공해 웹 트래픽을 자동으로 프락시 서버로 리다이렉트한다.

## 클라이언트 프락시 설정 : PAC 파일
<img width="610" alt="image" src="https://github.com/user-attachments/assets/d2dd8dd3-e87d-4691-8c55-ffea68bb3de7" />

- 수동 프락시 설정은 간단하지만 유연하지 않으며 장애 시 대체 옵션이 없고, 많은 브라우저를 설정하는 데 어려움이 있다. 
- 반면, PAC 파일은 자바스크립트로 동적으로 프락시 서버를 계산해 주며, 브라우저는 이를 사용해 각 요청에 적합한 프락시를 선택한다.
- PAC 파일은 .pac 확장자를 가지며, FindProxyForUrl(url, host) 함수로 프락시 서버를 지정한다.

## 클라이언트 프락시 설정 : WPAD
- 웹 프락시 자동발견 프로토콜(WPAD)은 브라우저가 자동으로 적합한 PAC 파일을 찾아 설정할 수 있게 해주는 프로토콜이다.
- WPAD는 다양한 발견 메커니즘을 사용하여 PAC URI를 찾고, 해당 파일을 통해 프락시 서버를 알아낸 뒤 요청을 처리한다.
- WPAD는 여러 방법을 순차적으로 시도하여 PAC 파일을 찾는데, 그 방법에는 DHCP, SLP, DNS 잘 알려진 호스트 명, DNS SRV 레코드, DNS TXT 레코드 등이 포함된다.