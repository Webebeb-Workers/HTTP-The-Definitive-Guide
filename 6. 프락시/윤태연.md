# 프락시

HTTP 프락시 서버의 전반적인 특징과 웹에서의 활용에 대한 설명으로 시작. 중개자로서 클라이언트와 서버 사이에서 HTTP 메시지를 처리하는 프락시의 핵심 개념과 동작 방식을 설명할 예정

# 프락시: 웹 중개자

<img width="710" alt="image" src="https://github.com/user-attachments/assets/8c517070-2f0b-4170-9a93-74662b4b90f6" />

> [!NOTE]
> 클라이언트를 대신해 서버와 통신하는 중개 서버, HTTP 클라이언트이자 서버의 역할을 동시에 수행하는 양면적 특성을 가진 시스템.

프락시는 서버와 클라이언트의 특성을 모두 가져야 함이 핵심. 서버로서 클라이언트의 요청을 적절히 처리하고, 클라이언트로서 서버에 올바른 요청을 보내는 기능이 필수적임.

## 프락시의 분류 체계

기준에 따른 프락시 용도가 있음.

#### 사용 범위에 따른 구분

프락시 서버는 하나의 클라이언트가 독점적으로 사용할 수도 있고, 여러 클라이언트가 공유할 수도 있음.

- **개인 프락시** : **단일** 사용자 전용으로 주로 클라이언트 컴퓨터에서 실행되는 형태
- **공용 프락시** : **다수** 클라이언트가 공유하는 형태로, 중앙 집중식 관리와 캐시 효율적

#### 프로토콜 처리에 따른 구분

<img width="675" alt="image" src="https://github.com/user-attachments/assets/c763f0cf-a511-4127-889d-651ef2d3aea9" />

- **순수 프락시** : **동일한 프로토콜**을 사용하는 애플리케이션 간의 중개
- **게이트웨이** : **서로 다른 프로토콜** 간의 변환과 중개

상용 프락시는 SSL 보안 프로토콜, SOCKS 방화벽, FTP 접근, 웹 기반 애플리케이션 등 게이트웨이 기능도 지원한다.
즉, 프락시와 게이트웨이의 경계가 모호해지는 추세로, 실제 구현에서는 프락시도 프로토콜 변환 기능을 포함하고 게이트웨이 기능도 함께 제공하는 것이 일반적임.

## 프락시의 활용

프락시 서버의 다양한 실용적 용도와 그를 통한 웹 서비스 개선 방안에 대한 설명. 보안 강화, 성능 향상, 비용 절감 등 다양한 목적으로 활용되는 프락시의 구체적 응용 사례가 핵심.

### 어린이 필터링 시스템

<img width="677" alt="image" src="https://github.com/user-attachments/assets/a2084559-221a-42e5-93a2-8b896f1f6e38" />

교육 기관에서 사용되는 필터링 프락시로, 교육용 콘텐츠는 허용하고 부적절한 콘텐츠는 차단하는 접근 제어 시스템.

### 문서 접근 제어 메커니즘

다수의 웹 서버와 리소스에 대한 중앙화된 접근 제어를 구현하는 시스템으로, 조직 전체의 일관된 보안 정책 적용.
분산된 웹 서버들에 대한 통합 접근 제어와 감사 추적 기능 제공이 특징. 각 클라이언트별 차등화된 접근 권한 부여가 가능함.

<img width="676" alt="image" src="https://github.com/user-attachments/assets/5ea85688-5dff-4fa3-b8d2-7117ca5c30ba" />

- 클라이언트1 : 제약 없이 서버의 뉴스 페이지에 접근할 수 있도록 허가
- 클라이언트2 : 제약 없이 인터넷 콘텐츠에 접근할 수 있는 권한 O
- 클라이언트3 : 서버 B에 접근하기 전에 먼저 비밀번호 요구

### 보안 방화벽

네트워크 보안 강화를 위한 응용 계층 프로토콜 통제. 조직 내외부의 트래픽을 단일 지점에서 감시하고 바이러스 제거 등 보안 기능 수행이 특징임.

<img width="675" alt="image" src="https://github.com/user-attachments/assets/a626ab0b-fb67-46e8-a5ef-a4a06e77ac49" />

또한 바이러스 제거 필요 웹이나 이메일 등에 사용할 수 있는, 트래픽을 세심히 살펴볼 수 있는 후크(hook)를 제공함.

### 웹 캐시

<img width="674" alt="image" src="https://github.com/user-attachments/assets/1d13c89e-8d56-4d36-8413-35c472fe96b5" />

자주 요청되는 문서의 로컬 사본을 관리해주는 '프락시 캐시'를 사용해 성능 향상과 네트워크 비용 절감. 인기 있는 콘텐츠에 대한 빠른 응답 제공이 특징임.

### 대리 프락시(Surrogate)

웹 서버를 위장/대신해 요청을 받을 수 있는 리버스 프락시로, 요청 받은 콘텐츠의 위치를 찾아줘 서버 성능 개선과 콘텐츠 분산.

<img width="669" alt="image" src="https://github.com/user-attachments/assets/4aadf38a-7ae4-4077-853a-be81c9d197fa" />

서버 가속기로도 활용되며, 콘텐츠 라우팅과 결합해 분산 네트워크 구성이 가능함.

### 콘텐츠 라우터

프락시는 인터넷 트래픽 조건과 콘텐츠의 종류에 따라 요청을 특정 웹 서버로 유도하는 콘텐츠 라우터로 동작함. 그 특징을 사용한 것이 콘텐츠 라우터.
트래픽 상황과 콘텐츠 특성에 따른 요청 라우팅.

<img width="680" alt="image" src="https://github.com/user-attachments/assets/655571a8-e07e-40eb-9057-ee587a2be84a" />

사용자나 콘텐츠 제공자의 요구사항에 따른 맞춤형 서비스 제공이 특징임.

### 트랜스코더 활용

콘텐츠의 형식을 클라이언트에 맞게 변환하는 시스템으로, 다양한 기기와 클라이언트, 네트워크 환경에 대해 사용자 경험 최적화 가능.

<img width="683" alt="image" src="https://github.com/user-attachments/assets/a7358144-793b-4899-80c5-24e0feeb233b" />

트랜스코딩 프락시는 콘텐츠의 포맷과 표현 방식을 클라이언트에 최적화된 형태로 변환하는 중개 시스템이 핵심.

- **이미지 최적화**
  - GIF를 JPG로 포맷 변환
  - 이미지 크기 축소
  - TV 디스플레이용 색상 강도 조절
- **텍스트 최적화**
  - 파일 압축
  - 모바일 기기용 페이지 축약
  - 실시간 다국어 번역

이미지 포맷 변환, 압축, 다국어 변환 등 다양한 콘텐츠 변환 기능 제공이 특징임.

### 익명화 프락시 구현

개인정보 보호를 위해 HTTP 메시지에서 식별 가능한 정보를 제거하는 시스템.

<img width="675" alt="image" src="https://github.com/user-attachments/assets/7a07eec7-1db0-4e60-95ae-ceb2832be474" />

User-Agent, From, Referer, Cookie 등 **개인 식별 정보 제거를 통한 익명성 보장** 가능함.

## 프락시 서버는 어디있는가?

프락시 서버의 **물리적 위치**와 **네트워크 구성에서의 역할**에 대해 서술. 배치 위치에 따른 프락시의 다양한 활용 방식과 트래픽 처리 메커니즘을 얘기함.

### 출구(Egress) 프락시

> [!NOTE]
> 로컬 네트워크와 인터넷 사이의 트래픽을 제어하기 위해 네트워크 출구 지점에 위치하는 프락시 시스템

<img width="512" alt="image" src="https://github.com/user-attachments/assets/d9436d77-249c-4f99-bc36-418117b9c838" />

주요 용도는 아래와 같음.

- 방화벽을 통한 보안 강화
- 인터넷 비용 절감
- 콘텐츠 필터링 수행

### 접근(입구) 프락시

> [!NOTE]
> ISP 접근 지점에 위치해 고객 요청을 종합적으로 처리하는 프락시 시스템

<img width="486" alt="image" src="https://github.com/user-attachments/assets/4e948366-34d6-4ae6-9180-b3bebdbdaf1e" />

캐시를 통한 다운로드 속도 개선과 대역폭 비용 절감이 주요 특징임.

### 대리 프락시

> [!NOTE]
> 웹 서버 바로 앞에 위치해 서버로의 직접 접근을 제어하고 보안과 성능을 개선하는 리버스 프락시 시스템

<img width="434" alt="image" src="https://github.com/user-attachments/assets/d624cc1c-972d-4911-9f17-6a43df917f4d" />

### 네트워크 교환 프락시

> [!NOTE]
> 인터넷 교차로의 트래픽 관리와 캐싱을 위한 고성능 프락시 시스템

<img width="506" alt="image" src="https://github.com/user-attachments/assets/4d215647-4ee5-47b9-8963-1ad37784e3c7" />

## 프락시 계층 구조

프락시들은 계층적 구조로 다른 프락시들과 연결할 수 있다.

### 정적 프락시 계층

> [!NOTE]
> 부모-자식 관계로 연결된 프락시들의 고정된 연쇄 구조

<img width="556" alt="image" src="https://github.com/user-attachments/assets/cee8e33b-b079-43ba-b1a4-98d972d97cfd" />

- 부모 프락시 : 서버에 가까운 다음 홉
- 자식 프락시 : 클라이언트에 가까운 이전 홉

### 동적 프락시 계층

> [!NOTE]
> 상황에 따라 유동적으로 프락시 연결을 변경하는 구조

<img width="552" alt="image" src="https://github.com/user-attachments/assets/545e546e-bc69-42b5-aa44-7be775f25d0f" />

프락시 서버는 다양한 근거로 전송할 프락시나 원 서버에 전달할 수 있다. 주요 라우팅 기준은 아래와 같다.

- 부하 균형 : 자식 프락시는 부하를 분산하기 위해 현재 부모들의 작업량 수준에 근거해 부모 프락시 선택
- 지리적 위치 : 자식 프락시는 원 서버의 지역을 담당하는 부모를 선택
- 프로토콜/콘텐츠 타입 : 특정 종류의 URI를 근거로 삼아 특별한 프락시로 전송
- 서비스 구독 상태 : 성능 개선을 위해 일정 금액 지불 시, 대형 캐시나 성능 개선을 위한 압축 엔진으로 라우팅

## 어떻게 프락시가 트래픽을 처리하는가

<img width="559" alt="image" src="https://github.com/user-attachments/assets/cf84be54-3827-4ae2-91a3-9b1944e09456" />

1. 클라이언트 수정 : 브라우저 설정을 통한 직접적인 프락시 지정
2. 네트워크 수정 : 인터셉트 프락시를 통한 자동 트래픽 리다이렉션
3. DNS 수정 : 대리 프락시가 서버의 이름과 IP 주소를 사용하는 방식
4. 웹 서버 수정 : HTTP 리다이렉션(305)을 통한 프락시 연결 유도

## 클라이언트 프락시 설정

클라이언트가 프락시를 사용하기 위한 다양한 설정 방식과 자동화를 설정할 수 있음. 수동 설정부터 자동 발견까지 프락시 설정의 여러 방법을 서술함.

웹 브라우저에서 프락시를 설정하는 네 가지 주요 방식은 수동 설정, 브라우저 기본 설정, PAC, WPAD가 있음.

### 수동 설정 메커니즘

> [!NOTE]
> 브라우저의 직접적인 프락시 서버 지정 방식

- 구글 크롬 : 설정 > 고급 설정 > 프록시 설정
- IE : 도구 > 인터넷 옵션 > LAN 설정

### PAC(Proxy Auto-Configuration) 파일 시스템

> [!NOTE]
> JS 기반의 동적 프락시 설정 방식으로, 상황에 따라 적절한 프락시를 자동으로 선택하는 시스템

#### 특징

- `.pac` 확장자 사용
- MIME 타입 : `application/x-ns-proxy-autoconfig`
- `FindProxyForURL()` 함수를 통한 프락시 결정

#### `FindProxyForllRL` 반환 값 종류

- DIRECT : 직접 연결
- PROXY `host:port` : 지정 프락시 사용
- SOCKS `host:port` : SOCKS 서버 사용

```js
function FindProxyForURL(urt, host) {
  if ((url.substring(0, 5) = 'http:')) {
    return 'PROXY http-proxy.mydomain.com:8080';
  } else if (url.substring(0, 4) == 'ftp:') {
    return 'PROXY ftp-proxy.mydomain.com:8080';
  } else {
    return 'DIRECT';
  }
}
```

### WPAD(Web Proxy Autodiscovery Protocol) 시스템

> [!NOTE]
> PAC 파일을 자동으로 찾아주는 프로토콜로, 여러 발견 메커니즘을 순차적으로 시도하는 시스템임

#### 동작 과정

1. WPAD로 PAC URI 탐색
2. PAC 파일 다운로드
3. PAC 실행으로 프락시 결정
4. 결정된 프락시로 요청 처리

#### 발견 메커니즘 순서

1. DHCP
2. SLP
3. DNS 호스트명
4. DNS SRV 레코드
5. DNS TXT 레코드
