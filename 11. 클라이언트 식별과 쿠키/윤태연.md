# 클라이언트 식별과 쿠키

HTTP는 기본적으로 "상태가 없는(stateless)" 프로토콜로, 각 요청과 응답이 독립적으로 처리됨.

하지만 현대 웹사이트에서는 개인화된 서비스 제공과 사용자 추적을 위해 클라이언트를 식별하는 다양한 기술이 필요함.

## 개별 접촉의 필요성

> [!NOTE]
> 웹 서버가 익명의 요청을 처리하는 것뿐만 아니라 서버와 통신하는 클라이언트를 추적하기 위해 사용하는 다양한 기술들의 집합

현대 웹사이트들의 개인화된 서비스 제공 필요성은 아래와 같음.

- **개별 인사** : 사용자에게 특화된 환영 메시지나 페이지 제공
- **사용자 맞춤 추천** : 고객의 흥미에 맞는 제품 추천
- **저장된 사용자 정보** : 배송 주소, 신용카드 정보 등을 저장해 편의성 제공
- **세션 추적** : 상태를 유지하며 사용자와 상호작용(장바구니 등)

## HTTP 헤더를 통한 식별 정보

> [!NOTE]
> 사용자에 대한 정보를 전달하는 HTTP 헤더들로, 브라우저가 서버에 요청을 보낼 때 자동으로 포함되는 정보들

### 주요 식별 관련 헤더

- `From` : 사용자의 이메일 주소 포함(스팸 우려로 대부분 사용 안 함)
- `User-Agent` : 사용자의 브라우저와 운영체제 정보
- `Referer` : 사용자가 현재 링크를 타고 온 이전 페이지의 URL
- `Authorization` : 사용자 이름과 비밀번호
- `Client-IP`/`X-Forwarded-For` : 클라이언트의 IP 주소
- `Cookie` : 서버가 생성한 ID 라벨

<img width="673" alt="image" src="https://github.com/user-attachments/assets/ed3f5131-1866-4e02-8029-bc8b5677e53a" />

## 클라이언트 IP 주소 기반 식별

초기에는 클라이언트의 IP 주소를 이용해 사용자를 식별하려 했으나 여러 한계점이 존재함.

### 한계점

- IP 주소는 사용자가 아닌 **컴퓨터를 식별**함(다수 사용자가 한 기기 사용 시 구분 불가)
- 많은 ISP는 **동적 IP 할당** 방식 사용(접속할 때마다 IP 변경)
- NAT나 방화벽 사용 시 **실제 IP 주소가 숨겨짐**
- 프락시 서버 사용 시 **서버는 프락시의 IP만 확인 가능**

일부 프락시는 `Client-IP`나 `X-Forwarded-For` 같은 확장 헤더로 원본 IP 보존을 시도하나 모든 프락시가 이를 지원하지 않음.

## 사용자 로그인 기반 식별

> [!NOTE]
> 사용자 이름과 비밀번호로 인증(로그인)하여 명시적으로 사용자를 식별하는 방식

HTTP는 `WWW-Authenticate`와 `Authorization` 헤더를 통해 로그인 기능 제공.

### 로그인 과정

<img width="680" alt="image" src="https://github.com/user-attachments/assets/8ed91968-4904-4061-b32f-33234c38a3ee" />

1. 사용자가 보호된 리소스 요청 시 서버는 401 응답과 함께 `WWW-Authenticate` 헤더 전송
2. 브라우저가 로그인 대화상자 표시
3. 사용자가 정보 입력 후, 브라우저는 `Authorization` 헤더에 자격증명 추가해 재요청
4. 이후 동일 사이트 요청 시 브라우저가 자동으로 인증 정보 전송

### 문제점

- 사이트마다 별도 로그인 필요
- 다양한 사용자명/비밀번호 조합 기억 필요
- 각 사이트마다 다른 규칙과 제약 존재

## 뚱뚱한 URL(Fat URL)

> [!NOTE]
> URL에 사용자 식별 정보나 세션 정보를 포함시키는 기술로, 주로 경로 처음이나 끝에 상태 정보를 추가하는 방식

### 특징

- URL에 사용자 상태 정보나 식별자 포함(예: `/exec/obidos/tg/browse/-/229220/002-1145265-8016838`)
- 서버가 페이지의 모든 링크를 동적으로 생성하여 식별 정보 유지

### 단점

- **심미적 문제** : 한마디로 못생겼음, 복잡하고 혼란스러운 URL 생성
- **공유 문제** : URL 공유 시 개인 정보 노출 위험
- **캐싱 불가** : 동일 페이지도 URL 변경으로 캐싱 어려움
- **서버 부하** : 모든 페이지와 링크 동적 생성 필요
- **이탈 위험** : 사용자가 다른 사이트로 이동하거나 일반 URL 사용 시 세션 정보 손실
- **세션 지속성 부재** : 로그아웃 시 모든 정보 손실

그래서 이러한 문제들을 해결하는 더 효율적인 식별 기술인 '쿠키'가 나옴.
