# 3. HTTP 메시지

- 애플리케이션 간에 주고받는 데이터 블록

## 3.1 메시지의 흐름

메시지는 클라이언트, 서버, 프락시 사이를 흐름

### 3.1.1 인바운드와 아웃바운드

![image](https://github.com/user-attachments/assets/5033f10a-cf74-443d-b7b9-5e383c8b803b)

**인바운드**

- 클라이언트 -> 서버로 메시지 전송

**아웃바운드**

- 서버 -> 클라이언트로 메시지 전송

### 3.1.2 업스트림과 다운스트림

![image](https://github.com/user-attachments/assets/fb51505e-b030-4c3a-86d9-555315b58657)

- 요청에서는 프락시 1이 프락시 3의 업스트림이지
  만 응답에서는 프락시 1이 프락시 3의 다운스트림임

**업스트림**

- 메시지의 발송자는 수신자의 업스트림

**다운스트림**

- 모든 메시지는 다운스트림으로 흐름

## 3.2 메시지의 각 부분

![image](https://github.com/user-attachments/assets/b324e422-15a7-4010-9550-e9e32ace27f3)

### 시작줄

- 메시지의 종류를 나타내는 첫 줄
- 요청 또는 응답 정보 포함
- 아스키 문자열
- 필수 요소

### 헤더

- Content-Type, Content-Length 등 메시지 속성 정보
- 아스키 문자열
- 각 줄은 CRLF(캐리지 리턴+개행)로 구분

### 본문

- 실제 데이터가 들어가는 부분
- 텍스트나 이진 데이터 포함 가능
- 이미지, 비디오, HTML 문서, 소프트웨어 애플리케이션, 전자우편 등 여러 종류의 디지털 데이터 실어나를 수 있음

### 3.2.1 메시지 문법

![image](https://github.com/user-attachments/assets/071e3331-0cad-47d1-a71f-dc40c8c2fb3e)

#### 요청 메시지

##### 형식

```
＜메서드＞ ＜요청 URL＞ ＜버전＞
＜헤더＞

＜본문>
```

##### 메서드

![image](https://github.com/user-attachments/assets/a57ddb00-3794-42ee-aa0f-ecf5ae15fe25)

- 클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작
- 메서드에 따라 요청 메시지 본문 유무가 다름
- 확장 메서드: HTTP는 쉽게 확장 가능 하기 때문에 서버 자체적으로로 추가 메서드 구현 가능

##### 요청 URL

- 요청하는 리소스를 지칭하는 완전한 URL 또는 URL의 경로 구성요소
- 요청 URL이 완전한 URL이 아니라면 서버는 URL에서 생략된 호스트/포트가 자신을 가리키는 것으로 간주

##### 버전

- 사용중인 HTTP 버전을 나타냄
- 애플리케이션이 지원하는 최고 버전을 표시 (ex. 난 2.0까지 지원할 수 있어)
- 아래와 같은 형식이고 메이저와 마이너는 모두 정수임
  ```
  HTTP/<메이저>.<마이너>
  ```
- 상호간의 기능 호환성을 파악하기 위함
- 상위 버전이 하위 버전의 기능을 사용해야 함
  (HTTP/1.2는 HTTP/1.1과 통신 시 1.1 기능만 사용)

##### 헤더

![image](https://github.com/user-attachments/assets/f5c0a6bb-f0c8-422a-a93e-9a39bb8277d5)

- 아래와 같이 `이름, 콜론(:), 선택적 공백, 값, CRLF가 순서대로 나타남

  ```
  이름: 값

  ```

- 필드가 0개 이상 존재함
- 긴 헤더 줄은 여러 줄로 쪼갤 수 있는데, 추가 줄 앞에는 최소 하나의 스페이스 혹은 탭을 둬야 함

  ```
  HTTP/1.0 200 OK
  Content-Type: image/gif
  Content-Length: 8572
  Server: Test Server
      Version 1.0

  ```

- 헤더는 빈 줄(CRLF)로 끝나 헤더의 끝과 본문의 시작을 구분함
- 특정 버전의 HTTP는 요청이나 응답에 특정 헤더가 포함돼야 유효한 것으로 간주함

###### 헤더 분류

- 일반 헤더

  - 요청과 응답 양쪽에 모두 나타날 수 있음
    ```
    Date: Tue, 15 Nov 2023 08:12:31 GMT
    Connection: keep-alive
    Cache-Control: no-cache
    ```

- 요청 헤더

  - 요청에 대한 부가 정보 제공
    ```
    Host: www.example.com
    User-Agent: Mozilla/5.0
    Accept: text/html
    Cookie: sessionId=abc123
    ```

- 응답 헤더

  - 응답에 대한 부가 정보 제공
    ```
    Server: nginx/1.18.0
    Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2023 07:28:00 GMT
    WWW-Authenticate: Basic
    ```

- Entity 헤더

  - 본문 크기와 콘텐츠, 혹은 리소스 그 자체를 서술
    ```
    Content-Type: text/html; charset=UTF-8
    Content-Length: 1024
    Content-Encoding: gzip
    Last-Modified: Tue, 15 Nov 2023 12:45:26 GMT
    ```

- 확장 헤더
  - 애플리케이션은 자체 헤더 만들어낼 수 있음
  - 명세에 정의되지 않은 새로운 헤더
  ```
  X-Powered-By: PHP/7.4.0
  X-RateLimit-Limit: 100
  X-Custom-Header: SomeValue
  ```

##### 본문

![image](https://github.com/user-attachments/assets/0a10010b-2e57-467f-ab6d-821eb1847b82)

- 없을 수도 있음 (선택적)
- 본문이 없어도 헤더 뒤에 CRLF는 필요
- 참고) 본문이 없는 경우, 클라이언트와 서버는 규칙에 따라 마지막 CRLF가 있어야 하지만 없는 메시지도 호환성을 위해 처리할 수 있어야 함

#### 응답 메시지

##### 형식

```
＜버전＞ ＜상태 코드＞ ＜사유 구절＞
＜헤더＞

＜본문＞
```

##### 상태 코드

![image](https://github.com/user-attachments/assets/4dec4760-5f57-464e-bc8c-6c32cfae81d4)

![image](https://github.com/user-attachments/assets/aac72af9-e6c5-408a-9e0a-ed5712de83d9)

- 서버가 클라이언트에게 요청에 대한 처리 결과를 알려주는 3자리 숫자
- ex) 200(성공), 404(클라이언트 에러)

##### 사유 구절

- 숫자인 상태 코드의 의미를 글로 설명해주는 짧은 문구
- 단순 설명 목적이어서 사유가 다르더라도 상태 코드가 같다면 똑같이 처리됨
- HTTP 명세는 사유 구절에 대한 엄경한 규칙이 없음
- ex) HTTP/1.0 200 `OK`

### 3.2.5 버전 0.9 메시지

- HTTP의 초기 버전
- 요청은 메서드와 URL만 있고 응답은 본문만 있는 매우 단순한 구조
- 버전 정보, 상태 코드, 헤더가 없어 현대적 용도로는 제한적입니다.

## 3.3 메서드
