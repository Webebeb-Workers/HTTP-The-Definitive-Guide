# HTTP 메시지

2장은 어떻게 HTTP 전송을 하느냐에 대한 것이라면, 이번 장은 HTTP 메세지의 모든 것임. 제대로 학습하자.

## HTTP 메시지 흐름

> [!NOTE]
> HTTP 메시지라 함은 클라이언트, 프락시, 서버 사이에서 주고받는 데이터 블록 <br />
> 메시지는 인바운드(원 서버로 향함)와 아웃바운드(클라이언트로 복귀함) 방향으로 흐름

<img width="499" alt="image" src="https://github.com/user-attachments/assets/91d3d343-193c-4f46-9e5f-1d630a5a59b6" />

또한, 모든 메시지는 다운스트림으로 흐르며, 발송자는 수신자의 업스트림.

<img width="499" alt="image" src="https://github.com/user-attachments/assets/e225df00-0061-4c8c-90a6-2c8572b8ae67" />

## 메시지의 각 부분

캐리지 리턴(ASCII 13)과 개행 문자(ASCII 10)로 구성 => CRLF로 종결해야함. 견고한 앱이면 그냥 개행 문자도 괜찮아야함.

### 3.2.1 메시지 문법

- **요청 메시지**와 **응답 메시지**로 분류
- 공통 구조
  - 시작줄(Start-line)
  - 헤더 블록
  - 본문(Body) - 선택

<img width="504" alt="image" src="https://github.com/user-attachments/assets/705519b7-5bd5-4191-b630-c3de17756c3a" />

#### 요청 메시지 형식

서버에게 리소스에 대해 무언가를 해달라고 부탁. 즉, 서버에 어떠한 동작이 일어나야하는지 작성해야함.

```
<메서드> <요청 URL> <버전>
<헤더>

<엔터티 본문>
```

#### 응답 메시지 형식

수행 결과에 대한 상태 정보와 결과 데이터를 클라이언트에게 돌려줌.

```
<버전> <상태코드> <사유구절>
<헤더>

<엔터티 본문>
```

### 메서드

> [!NOTE]
> 클라이언트가 서버에게 요청하는 동작을 정의 <br />
> 각 서버마다에 확장 메서드 가능

| 메서드  | 설명                          | 메시지 본문 여부 |
| ------- | ----------------------------- | ---------------- |
| GET     | 문서 등 리소스 가져오기       | 없음             |
| HEAD    | 헤더만 가져오기               | 없음             |
| POST    | 서버에 처리 데이터 전송       | 있음             |
| PUT     | 서버에 데이터 저장            | 있음             |
| TRACE   | 프락스-서버 경로 추적         | 없음             |
| OPTIONS | 사용 가능 메서드, 리소스 확인 | 없음             |
| DELETE  | 리소스 삭제                   | 없음             |

### 상태 코드

> [!NOTE]
> 응답의 결과를 나타내는 세 자리 숫자 <br />
> 프로그램이 에러를 처리하기 용이할 수 있도록 설정

| 전체 범위 | 정의된 범위 | 분류            |
| --------- | ----------- | --------------- |
| 100-199   | 100-101     | 정보            |
| 200-299   | 200-206     | 성공            |
| 300-399   | 300-305     | 리다이렉션      |
| 400-499   | 400-415     | 클라이언트 에러 |
| 500-599   | 500-505     | 서버 에러       |

HTTP 통신을 사용할 때, 주로 사용하는 상태 코드는 아래와 같음.

- `200 OK`: 성공
- `401 Unauthorized`: 인증 필요
- `404 Not Found`: 리소스 없음

> [!TIP]
> HTTP 프로토콜은 확장성이 좋아 다른 상태코드를 커스텀해 추가할 수 있음 <br />
> 또한, 그 코드가 포함되는 상태 범위 내의 일반 구성원으로서 다뤄야함

### 사유 구절

> [!NOTE]
> 상태 코드에 대한 설명적 텍스트, 정해진 규칙따위 없음 <br />
> 사람에게 이해를 돕기 위해 사용, 프로그램 로직과는 무관

### 버전 번호

> [!NOTE]
> 통신하는 양쪽 애플리케이션의 프로토콜 버전이 어느 정도까지 인지 이해할 수 있는 버전 명시 <br />
> `HTTP/<메이저>.<마이너>` 형식

\+ 주의! HTTP/2.22는 HTTP/2.3보다 큼. 소수점이 아닌 22버전과 3버전이기 때문에.

### 헤더

> [!NOTE]
> Start-line 외 추가 정보 제공을 위한 블록, `키: 값` 쌍으로 정의 <br />
> 값이 클 경우 줄바꿈 가능, 그 앞에 스페이스 등 탭 문자가 와야함

#### 분류

- **일반 헤더** : 요청과 응답 양쪽
- **요청 헤더** : 요청에 대한 부가 정보
- **응답 헤더** : 응답에 대한 부가 정보
- **엔터티 헤더** : 본문 크기와 콘텐츠, 혹은 리소스 그 자체를 서술
- **확장 헤더** : 명세에 정의되지 않은 새로운 헤더, 커스텀

#### 예시

| 헤더 예시                                  | 설명                                              |
| ------------------------------------------ | ------------------------------------------------- |
| `Date: Tue, 3 Oct 1997 02:16:03 GMT`       | 서버 응답 시각                                    |
| `Content-length: 15040`                    | 15,040바이트 길이를 가진 엔터티 본문              |
| `Content-type: image/gif`                  | 엔터티 본문 타입은 GIF 이미지                     |
| `Accept: image/gif, image/jpeg, text/html` | 클라이언트에게 응답은 GIF, JPEG 이미지, HTML 가능 |

- `Content-Length`: 본문 크기
- `Content-Type`: 본문 타입
- `Accept`: 클라이언트 수용 타입

### 엔터티 본문(Body)

> [!NOTE]
> 메시지의 화물, 필요 데이터를 실을 수 있음 <br />
> 텍스트, 이진 데이터(이미지, 오디오, 앱 등) 포함 가능

### HTTP/0.9 메시지

<img width="507" alt="image" src="https://github.com/user-attachments/assets/fecb8ceb-fbfc-4f98-926f-dde11df9d3f8" />

- 초기 버전으로 단순함
- 요청: 메서드와 URL만 포함
- 응답: 엔터티 본문만 포함
- 현재는 제한적 사용
